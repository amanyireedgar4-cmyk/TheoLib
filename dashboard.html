<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Library ‚Äî TheoLib</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0b0f1a;
  --panel:#12172a;
  --accent:#4cc9f0;
  --text:#e5e7eb;
  --muted:#9ca3af;
}
body{
  margin:0;
  font-family:Inter, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}
nav{
  padding:18px 28px;
  background:#050814;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
nav h2{margin:0;color:var(--accent)}
nav a{color:var(--text);text-decoration:none;font-size:14px}

section{
  max-width:900px;
  margin:auto;
  padding:50px 20px;
}

h3{color:var(--accent)}
.card{
  background:var(--panel);
  padding:18px;
  border-radius:14px;
  margin-bottom:14px;
}
.card small{color:var(--muted)}
.empty{
  text-align:center;
  color:var(--muted);
  margin-top:60px;
}
</style>
</head>

<body>

<nav>
  <h2>TheoLib</h2>
  <a href="library.html">‚Üê Back to Library</a>
</nav>

<section>
<h3>üìö My Reading History</h3>
<div id="userInfo"></div>
<div id="books"></div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC7LjxapWLQCW_zLRCOZS25hWVEaOG1mFY",
  authDomain: "theolib-426cf.firebaseapp.com",
  projectId: "theolib-426cf",
  storageBucket: "theolib-426cf.firebasestorage.app",
  messagingSenderId: "879359514394",
  appId: "1:879359514394:web:259ad5ed2e8949e2e97ea3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const booksDiv = document.getElementById("books");
const userInfo = document.getElementById("userInfo");

onAuthStateChanged(auth, async user=>{
  if(!user){
    booksDiv.innerHTML = `
      <p class="empty">
        Please log in to see your reading history üìñ
      </p>`;
    return;
  }

  userInfo.innerHTML = `<p>Logged in as <b>${user.email}</b></p>`;

  const snap = await getDoc(doc(db,"users",user.uid));
  if(!snap.exists() || !snap.data().booksRead?.length){
    booksDiv.innerHTML = `
      <p class="empty">
        You haven‚Äôt read any books yet.
      </p>`;
    return;
  }

  snap.data().booksRead.forEach(b=>{
    const d = b.readAt?.toDate?.();
    booksDiv.innerHTML += `
      <div class="card">
        <b>${b.title}</b><br>
        <small>${b.author}</small><br>
        <small>Read on: ${d ? d.toLocaleString() : "‚Äî"}</small><br>
        <a href="${b.link}" target="_blank" style="color:#4cc9f0">
          Open again ‚Üí
        </a>
      </div>`;
  });
});
</script>

</body>
</html>

