<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard â€” TheoLib</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="styles.css">

<script type="module" src="firebase.js"></script>
<script type="module" src="library.logic.js"></script>
</head>

<body onload="loadDashboard()">

<nav class="top-nav">
  <h2>TheoLib</h2>
  <div>
    <a href="index.html">Home</a>
    <a href="library.html">Library</a>
    <a href="mylibrary.html">My Library</a>
    <a href="dashboard.html" class="active">Dashboard</a>
  </div>
</nav>

<section class="dashboard-section">

<h1>ðŸ“Š Dashboard</h1>
<p class="subtitle">Your activity overview.</p>

<!-- USER PANEL -->
<div class="panel">
  <h2>ðŸ‘¤ Your Stats</h2>
  <ul>
    <li><strong>Email:</strong> <span id="userEmail">â€”</span></li>
    <li><strong>Books Read:</strong> <span id="booksRead">0</span></li>
    <li><strong>Books Saved:</strong> <span id="booksSaved">0</span></li>
    <li><strong>Last Active:</strong> <span id="lastActive">â€”</span></li>
  </ul>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="panel admin hidden">
  <h2>ðŸ‘‘ Admin Overview</h2>
  <ul>
    <li><strong>Total Users:</strong> <span id="totalUsers">â€”</span></li>
    <li><strong>Total Reads:</strong> <span id="totalReads">â€”</span></li>
    <li><strong>Total Saves:</strong> <span id="totalSaves">â€”</span></li>
    <li><strong>Top Countries:</strong> GoatCounter</li>
    <li><strong>Devices / Browsers:</strong> GoatCounter</li>
  </ul>
</div>

</section>

<footer>
TheoLib Â© 2026 Â· Insight before action
</footer>

<script>
const ADMIN_EMAIL = "theolib41@gmail.com";

function loadDashboard() {
  auth.onAuthStateChanged(user => {
    if (!user) {
      alert("Please log in first.");
      location.href = "auth.html";
      return;
    }

    document.getElementById("userEmail").textContent = user.email;

    db.collection("users").doc(user.uid).get().then(doc => {
      const data = doc.data() || {};
      document.getElementById("booksRead").textContent = (data.read || []).length;
      document.getElementById("booksSaved").textContent = (data.saved || []).length;
      document.getElementById("lastActive").textContent =
        data.lastActive?.toDate().toLocaleString() || "â€”";
    });

    if (user.email === ADMIN_EMAIL) {
      document.getElementById("adminPanel").classList.remove("hidden");
    }
  });
}
</script>

</body>
</html>
